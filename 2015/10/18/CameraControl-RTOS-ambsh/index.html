<!DOCTYPE html>
<html lang="null">
    
<head>
    <meta http-equiv="Content-Type" content="text/html" charset="UTF-8" >
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="Kromond">
    <title>CameraControl_RTOS-ambsh - Kromond</title>
    <meta name="author" content="~kromond">
    <meta name="description" content="Kromond">
    <link rel="icon" href="/oldblog/assets/images/ms-icon-70x70.png">
    
        <link rel="alternative" type="application/atom+xml" title="RSS" href="atom.xml">
    
    <!--STYLES-->
    <link rel="stylesheet" href="/oldblog/assets/css/style.min.css">
    <!--STYLES END-->
    
    <script type="text/javascript">
        var _gaq = _gaq || [];
        _gaq.push(['_setAccount', 'UA-64554420-1']);
        _gaq.push(['_trackPageview']);
        (function() {
            var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
            ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
            var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
        })();
    </script>

</head>

    <body>
        <div id="blog">
            <header id="header" data-behavior="1">
    <i id="btn-open-sidebar" class="fa fa-lg fa-bars"></i>
    <h1 class="header-title">
        <a class="header-title-link" href="https://kromond.github.io/oldblog">Kromond</a>
    </h1>
    
        <a class="header-right-picture" href="/oldblog/#about">
            <img class="header-picture" src="/oldblog/assets/images/cloudtankIcon.jpg"/>
        </a>
    
</header>
            <nav id="sidebar" data-behavior="1">
    
    <div class="sidebar-profile">
        <a href="/oldblog/">
            
            <img class="sidebar-profile-picture" src="/oldblog/assets/images/cloudtankIcon.jpg"/>
            
        </a>
        <span class="sidebar-profile-name">~kromond</span>
    </div>
    
    
    <ul class="sidebar-buttons">
        
        <li class="sidebar-button">
            
                <a  class="sidebar-button-link " href="/oldblog/oldblog/">
            
                    <i class="sidebar-button-icon fa fa-lg fa-anchor"></i>
                    <span class="sidebar-button-desc">Home</span>
                </a>
        </li>
        
        <li class="sidebar-button">
            
                <a  class="sidebar-button-link " href="/oldblog/oldblog/all-categories">
            
                    <i class="sidebar-button-icon fa fa-lg fa-indent"></i>
                    <span class="sidebar-button-desc">Categories</span>
                </a>
        </li>
        
        <li class="sidebar-button">
            
                <a  class="sidebar-button-link " href="/oldblog/oldblog/all-tags">
            
                    <i class="sidebar-button-icon fa fa-lg fa-tags"></i>
                    <span class="sidebar-button-desc">Tags</span>
                </a>
        </li>
        
        <li class="sidebar-button">
            
                <a  class="sidebar-button-link " href="/oldblog/oldblog/all-archives">
            
                    <i class="sidebar-button-icon fa fa-lg fa-server"></i>
                    <span class="sidebar-button-desc">Archives</span>
                </a>
        </li>
        
        <li class="sidebar-button">
            
                <a  class="sidebar-button-link st-search-show-outputs" href="/oldblog/oldblog/#search">
            
                    <i class="sidebar-button-icon fa fa-lg fa-search"></i>
                    <span class="sidebar-button-desc">Search</span>
                </a>
        </li>
        
        <li class="sidebar-button">
            
                <a  class="sidebar-button-link " href="/oldblog/oldblog/#about">
            
                    <i class="sidebar-button-icon fa fa-lg fa-plug"></i>
                    <span class="sidebar-button-desc">About me</span>
                </a>
        </li>
        
    </ul>
    
    <ul class="sidebar-buttons">
        
    </ul>
    
    <ul class="sidebar-buttons">
        
        <li class="sidebar-button">
            
                <a  class="sidebar-button-link " href="/oldblog/oldblog/atom.xml">
            
                    <i class="sidebar-button-icon fa fa-lg fa-rss"></i>
                    <span class="sidebar-button-desc">RSS</span>
                </a>
        </li>
        
    </ul>
    
</nav>
            <div id="main" data-behavior="1">
                
<article class="post" itemscope itemType="http://schema.org/BlogPosting">
    
        <div class="post-header main-content-wrap">
    
        <h1 class="post-title" itemprop="headline">CameraControl_RTOS-ambsh</h1>
    
    <div class="post-meta">
    <time  itemprop="datePublished" content="Sun Oct 18 2015 12:26:50 GMT+1300">
        Oct 18, 2015
    </time>
    
</div>
</div>
    
    <div class="post-content markdown main-content-wrap" itemprop="articleBody">
        <p>I have spent a bit of time looking into what sort of software control is possible.  These cameras are similar to gopro.  There are a couple of well traveled resources for this kind of activity, like <a href="https://dashcamtalk.com/forum/forums/xiaomi.153/" target="_blank" rel="external">dashcamtalk</a> and some relevant gopro sources like: this interesting <a href="https://www.defcon.org/images/defcon-21/dc-21-presentations/Manning-Lanier/DEFCON-21-Manning-Lanier-GoPro-or-GTFO-Updated.pdf" target="_blank" rel="external">slideshow</a> referencing this <a href="https://github.com/evilwombat/gopro-usb-tools" target="_blank" rel="external">evil wombat github</a>.  I’ve also spent some time browsing <a href="https://github.com/KonradIT/autoexechack" target="_blank" rel="external">this KonradIT gopro collectioon</a></p>
<p><img src="screenshot.jpg" alt="screnshotconsole"></p>
<p>There seems to be two os’s running simultaniously.  One is linux busybox.  This provides wifi and a few other services.  The other os is a rtos and this controls the camera and image processing</p>
<p>The basics to getting console control for linux looks like this: </p>
<p>add an empty file to the root of the sd card with this name: </p>
<p>enable_info_display.script</p>
<p>This exposes the linux os to telnet at this addr: “192.168.42.1”, and will show the linux filesystem and many linux commands.  It’s pretty amazing to interact with linux when it’s driving these kind of tiny devices.</p>
<p>The rtos is more opaque.  There is a small level of control on boot, as seen above, when files with certain names are found at the root of the sd card, things happen.  firmware.bin is one example.  a file with this name will try to install firmware update to the camera.  another is autoexec.ash</p>
<p>RTOS commands found in the autoexec.ash are executed on boot up by the rtos.  All valid commands found there will be run, including a valid call to the linux os: lu_util exec.  Some key notes on this: a newline is required at the end of the file, unix formated. Possible at the start as well.  Also some time is requried to execute some commands and the ‘sleep’ function is often employed to space out function calls</p>
<p>‘lu_util exec’ is used in these scripts to send commands from rtos to linux for execution.  As of yet, a similar command from linux to the rtos does not seem to be elaborated anywhere, but camera commands can be sent to port 7878.  Here are some <a href="https://github.com/deltaflyer4747/Xiaomi_Yi/tree/master/Standalone_scripts" target="_blank" rel="external">python examples</a> sending json strings to this port</p>
<p>It’s also possible to get ftp access to the linux filesystem.  Make a shell script that looks like this inside:</p>
<figure class="highlight lsl"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">nohup tcpsvd -u root -vE <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span> <span class="number">21</span> ftpd -w / &gt;&gt; /dev/null <span class="number">2</span>&gt;&amp;<span class="number">1</span> &amp;</div><div class="line"></div></pre></td></tr></table></figure>
<p>name it ftp.sh, put it at the root of the sd card and call lu_util exec on it from an autoexec.ash</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="comment"># enable the ftp server</span></div><div class="line">lu_util <span class="built_in">exec</span> <span class="string">'/tmp/fuse_d/ftp.sh</span></div><div class="line"></div></pre></td></tr></table></figure>
<p>I’ve been mostly looking for a way to get wired control of either the linux shell or the ambsh shell and as of yet have been unsuccessful.  I did some dissassembly to see if I can spot serial connection points.  I am not super keen for that approach.  I’d much prefer something that took advantage of the existing usb ports.  I’m currently investigating a ethernet to usb connector.  </p>
<p><img src="YDXJ0033.jpg" alt="ethernet"></p>
<p>It doesnt seem to be recognized.   I will keep digging but finding the linux filesystem read only, I am not sure I can do much with this…</p>

        
            
        
    </div>
    <div class="post-footer main-content-wrap">
        
            <div class="post-footer-tags">
                <span class="text-color-light text-small">TAGGED IN</span><br/>
                
    <a class="tag tag--primary tag--small t-link" href="/oldblog/tags/xiaomiYi/">xiaomiYi</a>

            </div>
        
        <div class="post-actions-wrap">
    <nav>
        <ul class="post-actions post-action-nav">
            <li class="post-action">
                
                    <a class="post-action-btn btn btn--default tooltip--top" href="/oldblog/2015/12/17/PeterMcLeavey/"  data-tooltip="PeterMcLeavey">
                
                    <i class="fa fa-angle-left"></i>
                    <span class="hide-xs hide-sm text-small icon-ml">PREVIOUS</span>
                </a>
            </li>
            <li class="post-action">
                
                    <a class="post-action-btn btn btn--default tooltip--top" href="/oldblog/2015/09/17/touchdesigner/" data-tooltip="Touchdesigner">
                
                    <span class="hide-xs hide-sm text-small icon-mr">NEXT</span>
                    <i class="fa fa-angle-right"></i>
                </a>
            </li>
        </ul>
    </nav>
    
</div>


        
    </div>
</article>



                <footer id="footer" class="main-content-wrap">
    <span class="copyrights">
        Copyrights &copy; 2017 ~kromond. All Rights Reserved.
    </span>
</footer>

            </div>
            
                <div id="bottom-bar" class="post-bottom-bar" data-behavior="1">
                    <div class="post-actions-wrap">
    <nav>
        <ul class="post-actions post-action-nav">
            <li class="post-action">
                
                    <a class="post-action-btn btn btn--default tooltip--top" href="/oldblog/2015/12/17/PeterMcLeavey/"  data-tooltip="PeterMcLeavey">
                
                    <i class="fa fa-angle-left"></i>
                    <span class="hide-xs hide-sm text-small icon-ml">PREVIOUS</span>
                </a>
            </li>
            <li class="post-action">
                
                    <a class="post-action-btn btn btn--default tooltip--top" href="/oldblog/2015/09/17/touchdesigner/" data-tooltip="Touchdesigner">
                
                    <span class="hide-xs hide-sm text-small icon-mr">NEXT</span>
                    <i class="fa fa-angle-right"></i>
                </a>
            </li>
        </ul>
    </nav>
    
</div>


                </div>
            
        </div>
        <div id="about">
    <div id="about-card">
        <div id="about-btn-close">
            <i class="fa fa-remove"></i>
        </div>
        
            <img id="about-card-picture" src="/oldblog/assets/images/headshot.jpg"/>
        
            <h4 id="about-card-name">~kromond</h4>
        
        
            <h5 id="about-card-job">
                <i class="fa fa-briefcase"></i>
                <br/>
                <p>artist</p>

            </h5>
        
        
            <h5 id="about-card-location">
                <i class="fa fa-map-marker"></i>
                <br/>
                Wellington NZ
            </h5>
        
    </div>
</div>
        <div id="cover" style="background-image:url('/oldblog/assets/images/treacle1.jpg');"></div>
    </body>
    <!--SCRIPTS-->
<script src="/oldblog/assets/js/script.min.js"></script>
<!--SCRIPTS END-->



</html>
